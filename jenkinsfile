pipeline {
    agent any

    parameters {
        string(name: 'aws_region', defaultValue: 'us-east-1', description: 'The AWS region to create all Github webhook logger services in')
        string(name: 'github_repo_name', defaultValue: '', description: 'GitHub repository name to create the webhook on')
        choice(name: 'action', choices: ['Create', 'Destroy'], description: 'Choose whether to create or destroy webhook and all resources')
    }

    stages {
        stage('Init') {
            steps {
                script {
                    sh 'terraform init'
                }
            }
        }

        stage('Apply or Destroy') {
            steps {
                script {
                    def action = params.create ? 'apply' : 'destroy'
                    sh "terraform ${action} -auto-approve -var='aws_region=${params.aws_region}' -var='github_repo_name=${params.github_repo_name}'"
                }
            }
        }
    }
}